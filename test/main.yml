---
# Tasks for tesing role

- name: test docker_provisioner role
  hosts: localhost
  tasks:
    - block:

      - name: cleanup log file
        copy:
          content: ""
          dest: ./test.log
          force: no

      # Test image provisioning
      - include_role:
          name: docker_provisioner
        vars:
          docker_provisioner_images: "{{ docker_provisioner_default_images }}"
          docker_provisioner_image_state: present
          docker_provisioner_image_force: true

      # Test container provisioning
      - block:
        - include_role:
            name: docker_provisioner
          vars:
            docker_provisioner_container_tty: true

        - name: test ssh containers provisioning
          include_role:
            name: docker_provisioner
          vars:
            docker_provisioner_container_tty: false

        vars:
          docker_provisioner_containers: >
            {{ docker_provisioner_default_containers }}
          docker_provisioner_container_state: started
          docker_provisioner_container_restart: true

      always:
        # Cleanup testing containers
        - include_role:
            name: docker_provisioner
          vars:
            docker_provisioner_containers: >
                {{ docker_provisioner_default_containers }}
            docker_provisioner_container_state: absent
